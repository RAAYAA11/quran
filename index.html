<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>جز عم المعلّم</title>
  <meta name="description" content="قائمة تشغيل بسيطة لروابط جزء عمّ المعلّم بأسماء السور كما تظهر في يوتيوب." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-6xl mx-auto p-4 sm:p-6">
    <header class="flex items-center justify-between gap-4 mb-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-red-600 text-white grid place-items-center shadow">
          <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        </div>
        <div>
          <h1 class="text-2xl sm:text-3xl font-semibold">جز عم المعلّم</h1>
          <p class="text-gray-600 text-sm">أسماء السور مأخوذة تلقائيًا من عناوين يوتيوب (بدون مفتاح API).</p>
        </div>
      </div>
      <div class="flex gap-2">
        <button id="copyAll" class="rounded-xl px-3 py-2 bg-gray-800 text-white hover:bg-black">نسخ جميع الروابط</button>
        <button id="downloadTxt" class="rounded-xl px-3 py-2 bg-gray-200 hover:bg-gray-300">تحميل .txt</button>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <aside class="lg:col-span-1 bg-white rounded-2xl shadow-sm p-4 max-h-[80vh] overflow-auto">
        <div class="mb-3">
          <input id="search" placeholder="ابحث باسم السورة" class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500" />
        </div>
        <ul id="list" class="space-y-2"></ul>
      </aside>

      <main class="lg:col-span-2 bg-white rounded-2xl shadow-sm p-4">
        <div class="space-y-3">
          <div class="flex items-center justify-between gap-2">
            <div>
              <div class="text-sm text-gray-500">المقطع الحالي</div>
              <h2 id="currentTitle" class="text-xl font-semibold">—</h2>
            </div>
            <div class="flex items-center gap-2 text-sm">
              <label class="flex items-center gap-2"><input id="bigText" type="checkbox" /> نص كبير</label>
              <a id="openInYT" href="#" target="_blank" class="rounded-xl px-3 py-2 bg-gray-800 text-white hover:bg-black">فتح في يوتيوب</a>
            </div>
          </div>
          <div class="aspect-video w-full overflow-hidden rounded-2xl bg-black">
            <iframe id="player" class="w-full h-full" src="" title="YouTube player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button id="prevBtn" class="rounded-xl px-4 py-2 bg-gray-200 hover:bg-gray-300">السابق</button>
            <button id="nextBtn" class="rounded-xl px-4 py-2 bg-red-600 text-white hover:bg-red-700">التالي</button>
          </div>
          <p class="text-xs text-gray-500">يتم جلب أسماء السور عبر واجهة <span class="mono">oEmbed</span> من يوتيوب.</p>
        </div>
      </main>
    </div>
  </div>

  <script>
    // === 1) روابط المستخدم ===
    const LINKS = [
      "https://www.youtube.com/watch?v=CmDbSjP39Os",
      "https://www.youtube.com/watch?v=akozUM8qKH0",
      "https://www.youtube.com/watch?v=m8_oOvfcQbk",
      "https://www.youtube.com/watch?v=xYWWw2rIc2Y",
      "https://www.youtube.com/watch?v=HaZ97gRKwrI",
      "https://www.youtube.com/watch?v=bIq69nYLqT4",
      "https://www.youtube.com/watch?v=leoqN4sW__4",
      "https://www.youtube.com/watch?v=RjWLbjmFXd4",
      "https://www.youtube.com/watch?v=eXfMH316SWk",
      "https://www.youtube.com/watch?v=ILAUWkfTz4M",
      "https://www.youtube.com/watch?v=MXrbm2CnVt4",
      "https://www.youtube.com/watch?v=9u5s22Jh6d0",
      "https://www.youtube.com/watch?v=MnBgphMr4ig",
      "https://www.youtube.com/watch?v=cDvAhfxl7Yk",
      "https://www.youtube.com/watch?v=VkkjHXRmXBw",
      "https://www.youtube.com/watch?v=g2pAUp_aiEE",
      "https://www.youtube.com/watch?v=1PruINUyVGo",
      "https://www.youtube.com/watch?v=mJZRhgd9bAc",
      "https://www.youtube.com/watch?v=WqfW1cJMrNw",
      "https://www.youtube.com/watch?v=tAWVbLSeO-w",
      "https://www.youtube.com/watch?v=-F99dhEw18k",
      "https://www.youtube.com/watch?v=dBYnfi6zUq0",
      "https://www.youtube.com/watch?v=5X57o4TZb1E",
      "https://www.youtube.com/watch?v=lTd8Hb6GDhY",
      "https://www.youtube.com/watch?v=LSgwApczDtY",
      "https://www.youtube.com/watch?v=JG6QtAPMar8",
      "https://www.youtube.com/watch?v=LnxhECLUA80",
      "https://www.youtube.com/watch?v=EgLr4WAVDu4",
      "https://www.youtube.com/watch?v=MD_vPSs9Euc",
      "https://www.youtube.com/watch?v=FXoCnC0fPwg",
      "https://www.youtube.com/watch?v=Y_vqCIThIuc",
      "https://www.youtube.com/watch?v=9UFpyJg3oaM",
      "https://www.youtube.com/watch?v=sBQHGwiBhfQ",
      "https://www.youtube.com/watch?v=5VpT7JsEs0Y",
      "https://www.youtube.com/watch?v=-Aa9lnQN6KI",
      "https://www.youtube.com/watch?v=lpRVBaXqLNk",
      "https://www.youtube.com/watch?v=AsOvgIPZLdg",
      "https://www.youtube.com/watch?v=AmWgbvwoBSQ",
    ];

    // === 2) أدوات مساعدة ===
    const $ = (sel) => document.querySelector(sel);
    const listEl = $('#list');
    const searchEl = $('#search');
    const playerEl = $('#player');
    const currentTitleEl = $('#currentTitle');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const openInYT = $('#openInYT');
    const copyAllBtn = $('#copyAll');
    const downloadTxtBtn = $('#downloadTxt');
    const bigText = $('#bigText');

    let items = LINKS.map((url, idx) => ({ url, idx, title: `مقطع ${idx+1}`, id: getId(url) }));
    let filtered = [...items];
    let currentIndex = 0;

    function getId(url){
      try{
        const u = new URL(url);
        if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        return u.searchParams.get('v') || '';
      }catch{ return ''; }
    }

    function watchUrl(id){ return `https://www.youtube.com/watch?v=${id}` }
    function embedUrl(id){ return `https://www.youtube.com/embed/${id}?rel=0&modestbranding=1`; }

    function renderList(){
      listEl.innerHTML = '';
      filtered.forEach((it, i) => {
        const active = items[currentIndex] && it.idx === items[currentIndex].idx;
        const li = document.createElement('li');
        li.className = `rounded-xl border p-3 ${active?'border-red-500 bg-red-50':'border-gray-200 bg-white'}`;
        li.innerHTML = `
          <button class="text-start w-full" data-idx="${it.idx}">
            <div class="font-medium">${escapeHtml(it.title)}</div>
            <div class="text-xs text-gray-500 break-all">${it.url}</div>
          </button>
        `;
        li.querySelector('button').addEventListener('click', () => selectByIdx(it.idx));
        listEl.appendChild(li);
      });
    }

    function selectByIdx(idx){
      const i = items.findIndex(x => x.idx === idx);
      if(i === -1) return;
      currentIndex = i;
      updatePlayer();
      renderList();
    }

    function updatePlayer(){
      const cur = items[currentIndex];
      if(!cur) return;
      playerEl.src = embedUrl(cur.id);
      currentTitleEl.textContent = cur.title || '—';
      openInYT.href = cur.url;
    }

    prevBtn.addEventListener('click', () => {
      if(currentIndex > 0){ currentIndex--; updatePlayer(); renderList(); }
    });
    nextBtn.addEventListener('click', () => {
      if(currentIndex < items.length - 1){ currentIndex++; updatePlayer(); renderList(); }
    });

    searchEl.addEventListener('input', () => {
      const q = searchEl.value.trim().toLowerCase();
      filtered = q ? items.filter(it => (it.title||'').toLowerCase().includes(q)) : [...items];
      renderList();
    });

    copyAllBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(items.map(x=>x.url).join('\n'));
        alert('تم نسخ جميع الروابط');
      } catch { alert('تعذّر النسخ، انسخي يدويًا.'); }
    });

    downloadTxtBtn.addEventListener('click', () => {
      const blob = new Blob([items.map(x=>x.url).join('\n')+'\n'], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'juz-amma-links.txt'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 3000);
    });

    bigText.addEventListener('change', () => {
      document.documentElement.classList.toggle('text-[18px]', bigText.checked);
    });

    // === 3) جلب عناوين يوتيوب عبر oEmbed ===
    async function fetchTitle(url){
      const api = `https://www.youtube.com/oembed?format=json&url=${encodeURIComponent(url)}`;
      try{
        const res = await fetch(api);
        if(!res.ok) throw new Error('oEmbed failed');
        const data = await res.json();
        return data.title || '';
      }catch{ return ''; }
    }

    async function hydrateTitles(){
      for(let i=0;i<items.length;i++){
        const t = await fetchTitle(items[i].url);
        if(t) items[i].title = t;
      }
    }

    (async function init(){
      await hydrateTitles();
      filtered = [...items];
      renderList();
      selectByIdx(items[0]?.idx ?? 0);
    })();

    function escapeHtml(s=''){return s.replace(/[&<>"']/g,(c)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))}
  </script>
</body>
</html>